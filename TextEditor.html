<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Text Editor</title>
    <style>
        body {
            font: 12px sans-serif;
            background-color: #eee;
        }

        div {
            margin: 1em;
        }
    </style>
</head>
<body>
    <form>
        <div>
            <h1>Text Editor</h1>
            <button id="shrink-textbox" type="button">-</button>
            <button id="grow-textbox" type="button">+</button>&nbsp;&nbsp;&nbsp;
            <button id="clear-all" type="button">clear all</button>
            <button id="clear-1-2" type="button">clear 1&amp;2</button>
        </div><div>
            <textarea name="mainInput" id="textarea1" style="width: 100%; height: 200px;"></textarea>
        </div><div>
            1: <input name="text1" style="width: 95%;" type="text" />
        </div><div>
            2: <input name="text2" style="width: 95%;" type="text" />
        </div><div>
            <button id="pre-post-pend" type="button">prefix [1], append [2]</button>
            <button id="replace-1-with-2" type="button">replace [1] with [2]</button>
            <button id="replace-1-with-linefeeds" type="button">replace [1] with line feeds</button>
        </div><div>
            <button id="remove-empty-lines" type="button">remove empty lines</button>
            <button id="colapse-lines" type="button">collapse lines to [1] chars</button>
        </div><div>
            <button id="to-upper" type="button">to upper</button>
            <button id="to-lower" type="button">to lower</button>
            <button id="underscores-to-upper" type="button">underscores to upper</button>
        </div>
        <div>
            <b>Notes:</b>
            <textarea name="myinpu2" id="textarea2" style="width: 100%; height: 100px;">^(\w+)[\n\r]*$
^(\w+)	(\w+)[\n\r]*$
</textarea>
        </div>
    </form>
    <script type="text/javascript">
        var mainInput = document.getElementsByName('mainInput')[0];
        var text1input = document.getElementsByName('text1')[0];
        var text2input = document.getElementsByName('text2')[0];

        document.getElementById('shrink-textbox').onclick = function () {
            mainInput.style.height = (Number(mainInput.style.height.replace('px', '')) - 25) + "px";
        }

        document.getElementById('grow-textbox').onclick = function () {
            mainInput.style.height = (Number(mainInput.style.height.replace('px', '')) + 25) + "px";
        }

        document.getElementById('clear-all').onclick = function () {
            mainInput.value = '';
            text1input.value = '';
            text2input.value = '';
        }

        document.getElementById('clear-1-2').onclick = function () {
            text1input.value = '';
            text2input.value = '';
        }

        document.getElementById('pre-post-pend').onclick = prePostPend;
        document.getElementById('replace-1-with-2').onclick = replaceWith;
        document.getElementById('replace-1-with-linefeeds').onclick = replaceWithLinefeeds;
        document.getElementById('remove-empty-lines').onclick = removeEmptyLines;
        document.getElementById('colapse-lines').onclick = colapseLines;
        document.getElementById('to-upper').onclick = function () { mainInput.value = mainInput.value.toUpperCase(); }
        document.getElementById('to-lower').onclick = function () { mainInput.value = mainInput.value.toLowerCase(); }
        document.getElementById('underscores-to-upper').onclick = convertUpperCase;

        function colapseLines() {
            var wordList = mainInput.value.replace(/[ ,\t,\r,\n]+/gim, ' ').split(' ');
            var newString = '';
            var lengthWrapped = 0;

            if (wordList.length > 0) {
                newString += wordList[0];

                if (wordList.length > 1) {
                    for (var i = 1; i < wordList.length; i++) {
                        if (newString.length + wordList[i].length + 1 - lengthWrapped > text1input.value) {
                            lengthWrapped = newString.length;
                            newString += '\n' + wordList[i];
                        } else {
                            newString += ' ' + wordList[i];
                        }
                    }
                }
                mainInput.value = newString;
            }
        }

        function prePostPend() {
            var splitString = mainInput.value.split("\n");
            var newString = "";
            for (i = 0; i <= splitString.length - 1; i++) {
                newString += text1input.value + splitString[i].replace(/\n|\r/gi, '') +
                    text2input.value + "\n";
            }
            mainInput.value = newString;
        }

        function removeEmptyLines() {
            // TODO Remove lines that have whitespace only too.
            var splitString = mainInput.value.split("\n");
            var newString = "";
            for (i = 0; i <= splitString.length - 1; i++)
                if (splitString[i].replace(/\n|\r/gi, '') != "")
                    newString += splitString[i].replace(/\n|\r/gi, '') + "\n";
            mainInput.value = newString;
        }

        function replaceWith() {
            var splitString = mainInput.value;
            var newString = splitString.replace(new RegExp(text1input.value,
                'gim'), text2input.value) + "\n";
            mainInput.value = newString;
        }

        function replaceWithLinefeeds() {
            var splitString = mainInput.value;
            var newString = splitString.replace(new RegExp("(" + text1input.value + ")",
                'gim'), "$1\n") + "\n";
            mainInput.value = newString;
        }

        function convertUpperCase() {
            //TODO Unexpectedly removes linefeeds.
            mainInput.value = mainInput.value.toLowerCase();
            var splitString = mainInput.value.split("\n");
            var newString = "";
            for (i = 0; i <= splitString.length - 1; i++)
                splitString[i] = splitString[i].split("_");

            for (i = 0; i <= splitString.length - 1; i++)
                for (j = 0; j <= splitString[i].length - 1; j++)
                    newString += splitString[i][j].substr(0, 1).toUpperCase() +
                        splitString[i][j].substr(1);

            mainInput.value = newString;
        }
    </script>
</body>
</html>
